<html>
<head>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link href="https://webfontworld.github.io/gmarket/GmarketSans.css" rel="stylesheet">
  <style type="text/css">
    @font-face {
      font-family: 'GmarketSansMedium';
      src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/GmarketSansMedium.woff') format('woff');
      font-weight: normal;
      font-style: normal;
    }

    body {
      font-family: 'GmarketSansMedium';
    }
  </style>
  <title>메인 페이지</title>
</head>
<body>
<div class="container mx-auto">
  <div th:if="${#authorization.expr('!isAuthenticated()')}" class="flex justify-end gap-3 py-3 border-b-2">
    <a href="/members/loginForm" class="btn btn-primary">로그인</a>
    <a href="/members/signupForm" class="btn btn-primary">회원가입</a>
  </div>
  <div th:unless="${#authorization.expr('!isAuthenticated()')}" class="flex justify-end gap-3 py-3">
    <a href="/posts/registerForm" class="btn btn-primary">게시글 작성</a>
    <a th:if="${#authorization.expression('hasAuthority(''ADMIN'')')}"
       href="/inquiry" class="btn btn-danger">문의 내역</a>
    <div class="flex-grow"></div>
    <p class="flex items-center">안녕하세요, <span th:text="${#authentication.principal.username}"> 사용자</span>님!</p>
    <a href="/members/info" class="btn btn-primary">마이페이지</a>
    <a href="/logout" class="btn btn-primary">로그아웃</a>
  </div>
</div>
<div class="container mx-auto">
  <div class="flex">
    <div class="flex-grow"></div>
    <form class=" flex w-50 mt-3 gap-3" th:action="@{/admins/search/members}" method="get">
      <input type="text" class="form-control" name="keyword" />
      <button class="btn btn-primary" type="submit">검색</button>
    </form>
    <div class="flex-grow"></div>
  </div>

  <div>
    <div class="flex justify-center border-b-2 bg-gray-200 py-2">
      <div class="w-2/12 flex justify-center">회원 번호</div>
      <div class="flex-grow flex justify-center border-x-2">이메일</div>
      <div class="flex-grow flex justify-center">닉네임</div>
      <div class="w-3/12 flex justify-center">생성일자</div>
      <div class="w-3/12 flex justify-center">차단 해제</div>
    </div>

    <div th:each="member, iterStat : ${members.content}" class="flex justify-center border-b-2 py-2 hover:bg-gray-100 hover:cursor-pointer">
      <div th:text="${member.memberId}" class="w-2/12 flex justify-center"></div>
      <div class="flex-grow flex justify-center  items-center border-x-2">
        <a th:href="@{|/posts/${member.memberId}|}" th:text="${member.email}"></a>
      </div>
      <div class="flex-grow flex justify-center  items-center border-x-2">
        <a th:href="@{|/posts/${member.memberId}|}" th:text="${member.nickname}"></a>
      </div>
      <div class="w-3/12 flex justify-center" th:text="${#temporals.format(member.createdAt,'YYYY-MM-dd')}"></div>
      <div class="w-3/12 flex justify-center items-center border-x-2">
        <form th:action="@{${member.isBlock} ? '/admins/members/' + ${member.memberId} + '/unblock' : '/admins/members/' + ${member.memberId} + '/block'}" method="post" class="m-0">
          <button
              type="submit"
              th:classappend="${member.isBlock} ? 'btn btn-danger' : 'btn btn-primary'">
            <span th:text="${member.isBlock} ? '차단 해제' : '차단 하기'"></span>
          </button>
        </form>
      </div>
    </div>

  </div>
  <!-- 페이지네이션 -->
  <nav class="container mx-auto flex justify-center my-10">
    <ul class="pagination">
      </li>
      <li th:class="${members.first} ? 'page-item disabled' : 'page-item'">
        <a class="page-link" th:href="@{|/posts?page=${members.number - 1}&amp;type=${type}|}">Prev</a>
      </li>
      <li th:each="pageNumber : ${#numbers.sequence(0, members.totalPages - 1)}" th:class="${members.number == pageNumber} ? 'page-item active' : 'page-item'">
        <a class="page-link" th:href="@{|/posts?page=${pageNumber}${type == null ? '' : '&amp;type=' + type}|}" th:text="${pageNumber + 1}"></a>
      </li>
      <li th:class="${members.last} ? 'page-item disabled' : 'page-item'">
        <a class="page-link" th:href="@{/posts?page=${members.number + 1}&amp;type=${type}}">Next</a>
      </li>
    </ul>
  </nav>
</div>
<script>
  const urlParams = new URLSearchParams(window.location.search);
  const categoryId = urlParams.get("categoryId");

  if(categoryId){
    document.getElementById('categoryId').value = categoryId;
  }
</script>
</body>

</html>
