<html>
<head>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
        crossorigin="anonymous">
  <link href="https://webfontworld.github.io/gmarket/GmarketSans.css" rel="stylesheet">
  <style type="text/css">
    @font-face {
      font-family: 'GmarketSansMedium';
      src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/GmarketSansMedium.woff') format('woff');
      font-weight: normal;
      font-style: normal;
    }

    body {
      font-family: 'GmarketSansMedium';
    }

  </style>
  <title>[[${post.id}]]번 게시글</title>
</head>
<body>
<div class="container mx-auto flex flex-column gap-3 border-b-2 pb-3 px-4">
  <div class="flex border-b-2 pl-5 pb-3 mt-4">
    <h1 class="text-3xl flex items-center">[[${post.id}]]번 게시글</h1>
    <div class="flex-grow"></div>
    <div class="flex items-center"><span class="badge text-bg-primary mr-2">카테고리</span>
      [[${post.category}]]
    </div>
    <div class="flex items-center"><span class="badge text-bg-primary ml-3 mr-2">작성자</span>
      [[${post.author}]]
    </div>
  </div>

  <div><span class="btn btn-primary">제목</span> [[${post.title}]]</div>
  <div><span class="btn btn-primary">내용</span> [[${post.content}]]</div>
  <div class="justify-end">
    <span class="btn btn-primary">작성일자</span>
    [[${#temporals.format(post.createdAt, 'YYYY-MM-dd HH:mm')}]]
  </div>

  <div class="self-center">
    <form th:action="@{/posts/{postId}/like(postId=${post.id})}" method="post" class="m-0">
      <button class="btn btn-danger text-lg" type="submit"
              th:disabled="${!(#authorization.expression('hasAuthority(''ADMIN'')') ||
	                                (#authorization.expr('isAuthenticated()')&&
	                                #authentication.principal != null))}">
        좋아요 : [[${post.likes}]]
      </button>
    </form>
  </div>


</div>
<div class="container mx-auto flex gap-3 justify-end my-4 items-center px-4">
  <form th:action="@{/posts/{postId}/updateForm(postId=${post.id})}" method="get" class="m-0">
    <button class="btn btn-warning" type="submit"
            th:disabled="${!(#authorization.expression('hasAuthority(''ADMIN'')') ||
	                                (#authorization.expr('isAuthenticated()') &&
	                                #authentication.principal != null &&
	                                post.author == #authentication.principal.username))}">
      수정하기
    </button>
  </form>
  <form id="boardDeleteForm" th:action="@{/posts/{postId}/delete(postId=${post.id})}"
        method="post" class="m-0">
    <button class="btn btn-danger" type="button"
            th:disabled="${!(#authorization.expression('hasAuthority(''ADMIN'')') ||
	                                (#authorization.expr('isAuthenticated()') &&
	                                #authentication.principal != null &&
	                                post.author == #authentication.principal.username))}"
            onclick="validateBoardDelete();">
      삭제하기
    </button>
  </form>
  <form th:action="@{/posts/{postId}/inquiry(postId=${post.id})}"
        method="post" class="m-0">
    <button class="btn btn-success" type="submit"
            th:disabled="${!(#authorization.expression('hasAuthority(''ADMIN'')') ||
	                                (#authorization.expr('isAuthenticated()') &&
	                                #authentication.principal != null))}">
      게시글 신고
    </button>
  </form>
  <form th:action="@{/posts}" method="get" class="m-0">
    <button class="btn btn-primary" type="submit">
      홈으로
    </button>
  </form>
</div>
<div class="container mx-auto">
  <div th:each="comment : ${post.comments}"
       class="px-4 border-b-2 py-2 hover:bg-gray-100 hover:cursor-pointer">
    <div class="text-base mb-1">작성자 : [[${comment.member.email}]]</div>
    <div class="text-sm">내용 : [[${comment.content}]]</div>
    <div class="text-xs flex justify-end"
         th:text="${#temporals.format(comment.createdAt,'YYYY-MM-dd HH:mm')}"></div>
    <div class="flex justify-end gap-2 mt-2">
      <form th:action="@{/posts/{postId}/comments/modify(postId=${post.id})}" method="post"
            class="m-0">
        <button class="btn btn-warning text-xs" type="submit"
                th:disabled="${!(#authorization.expression('hasAuthority(''ADMIN'')') ||
					                (#authorization.expr('isAuthenticated()') && comment.member != null &&
					                #authentication.principal != null &&
					                comment.member.email == #authentication.principal.username))}">
          댓글 수정
        </button>
      </form>
      <form id="commentDeleteForm"
            th:action="@{/posts/{postId}/comments/{commentId}/delete(postId=${post.id}, commentId=${comment.id})}"
            method="post" class="m-0">
        <button class="btn btn-danger text-xs" type="button" onclick="validateCommentDelete()"
                th:disabled="${!(#authorization.expression('hasAuthority(''ADMIN'')') ||
										                (#authorization.expr('isAuthenticated()') && comment.member != null &&
										                #authentication.principal != null &&
										                comment.member.email == #authentication.principal.username))}">
          댓글 삭제
        </button>
      </form>
      <form
          th:action="@{/posts/{postId}/comments/{commentId}/inquiry(postId=${post.id}, commentId=${comment.id})}"
          method="post" class="m-0">
        <button class="btn btn-success text-xs" type="submit"
                th:disabled="${!(#authorization.expression('hasAuthority(''ADMIN'')') ||
										                (#authorization.expr('isAuthenticated()') && comment.member != null &&
										                #authentication.principal != null ))}">
          댓글 신고
        </button>
      </form>
    </div>
  </div>
</div>

<div class="container mx-auto mt-3">
  <form class="form-control" th:action="@{/posts/{postId}/comments(postId=${post.id})}"
        method="post" th:object="${commentCreateRequest}">
    <div class="mb-3">
					<textarea class="form-control" name="content" placeholder="댓글 내용을 입력해주세요."
                    th:disabled="${!(#authorization.expr('isAuthenticated()'))}" maxlength="200"
          ></textarea>
    </div>
    <div class="flex gap-3 my-3">
      <button class="btn btn-primary" type="submit"
              th:disabled="${!(#authorization.expr('isAuthenticated()'))}">
        댓글 생성
      </button>
      <button class="btn btn-danger" type="reset"
              th:disabled="${!(#authorization.expr('isAuthenticated()'))}">
        초기화
      </button>
    </div>
  </form>
</div>

<script>
  function validateBoardDelete() {
    var confirmation = confirm("게시글을 정말로 삭제하시겠습니까 ?");
    if (confirmation == true) {
      document.getElementById('boardDeleteForm').submit();
    } else {
      return false;
    }
  }
</script>
<script>
  function validateCommentDelete() {
    var confirmation = confirm("댓글을 정말로 삭제하시겠습니까 ?");
    if (confirmation == true) {
      document.getElementById('commentDeleteForm').submit();
    } else {
      return false;
    }
  }
</script>
</body>
</html>
